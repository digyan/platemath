<!DOCTYPE html>
<html>
<head>
    <title>Weight Lifting Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
        }
        input, textarea {
            width: 90%;
            margin: 10px auto;
            padding: 10px;
        }
    </style>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = 'YOUR_CLIENT_ID_FROM_GITHUB_SECRETS';
        const API_KEY = 'YOUR_API_KEY_FROM_GITHUB_SECRETS';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let gapiInited = false;

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        async function initClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                scope: SCOPES,
            });
            gapiInited = true;
        }

        async function signIn() {
            if (!gapiInited) {
                alert("Google API not initialized yet!");
                return;
            }
            try {
                await gapi.auth2.getAuthInstance().signIn();
                alert("Signed in successfully!");
            } catch (error) {
                console.error("Error signing in:", error);
                alert("Failed to sign in.");
            }
        }

        async function saveData() {
            if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
                alert("You need to sign in first!");
                return;
            }

            const workoutData = document.getElementById('workoutLog').value;

            const fileContent = new Blob([workoutData], { type: 'text/plain' });

            const metadata = {
                name: 'weight_lifting_log.txt',
                mimeType: 'text/plain',
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', fileContent);

            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${gapi.auth.getToken().access_token}`,
                    },
                    body: form,
                });

                if (response.ok) {
                    alert("Data saved successfully!");
                } else {
                    console.error("Failed to upload:", response.statusText);
                    alert("Failed to save data.");
                }
            } catch (error) {
                console.error("Error uploading file:", error);
                alert("Error saving data.");
            }
        }
    </script>
</head>
<body onload="handleClientLoad()">
    <h1>Weight Lifting Tracker</h1>
    <textarea id="workoutLog" rows="10" placeholder="Enter your weight lifting log here..."></textarea>
    <br/>
    <button onclick="signIn()">Sign In with Google</button>
    <button onclick="saveData()">Save Data to Google Drive</button>
</body>
</html>
